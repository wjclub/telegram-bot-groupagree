# template to deploy a new complete instance of the application

# now say it with me
# ğŸ‘ğŸ½ docker ğŸ‘ğŸ½ compose ğŸ‘ğŸ½ is ğŸ‘ğŸ½ not ğŸ‘ğŸ½ a ğŸ‘ğŸ½ production ğŸ‘ğŸ½ grade ğŸ‘ğŸ½ orchestrator ğŸ‘ğŸ½
# you have been warned

services:
    groupagreebot:
        image: ghcr.io/wjclub/telegram-bot-groupagree:latest
        restart: unless-stopped
        depends_on:
        - db
        networks:
            - backend
    db:
        image: docker.io/mysql:latest
        restart: unless-stopped
        # use docker secrets to store the password
        environment:
            MYSQL_ROOT_PASSWORD_FILE: /run/secrets/mysql_root_password
            MYSQL_DATABASE: groupagree
            MYSQL_USER: groupagree
            MYSQL_PASSWORD_FILE: /run/secrets/mysql_password
        secrets:
            - mysql_root_password
            - mysql_password
        volumes:
            - db_data:/var/lib/mysql
        networks:
            - backend
    adminer:
        image: adminer:latest
        restart: unless-stopped
        profiles:
          - adminer
        ports:
            - 8080:8080
        depends_on:
            - db
        environment:
            ADMINER_DEFAULT_SERVER: db
        networks:
            - backend

secrets:
    mysql_root_password:
        file: ./secrets/mysql_root_password
    mysql_password:
        file: ./secrets/mysql_password

volumes:
    db_data:       